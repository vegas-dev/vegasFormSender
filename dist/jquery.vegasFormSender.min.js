/**
 * @name vegas form sender
 * @copyright by vegas s.
 * @date: 23.07.2018
 * @version  1.0
 *
 * Описание.
 * Программа для сборки данных с формы и отправки их на сервер через ajax,
 * упрощая обработку и выдачу результата...
 *
 * Инструкции.
 * Инициализация: $('#какая-то форма').vegasFormSender();
 *
 * Параметры:
 * action: путь до обработчика, так же может быть указан непосредственно в форме.
 * method: метод отправки get или post, так же может быть указан непосредственно в форме.
 * fields: дополнительные параметры, указываются в ввиде объекта {ключ: значение},
 * либо этот объект возвращается через колбэк например:
 * fields: function() {
 * 		return {ключ: значение}
 * }
 * redirectError: перенаправление на страницу с фатальной ошибкой
 * redirectSuccess: перенаправление на страницу после успешного запроса
 *
 * Обработчики событий:
 * Плагин возвращает два события, об удачной отправке или о фатальной ошибке:
 * success: function (data) {
 * 		// ответ пришел от сервера
 * }
 * error: function (status) {
 * 		// ответ не пришел от сервера
 * }
 */
!function(u){u.fn.vegasFormSender=function(o){o=u.extend({error:function(){},success:function(){},beforeSend:function(){}},o||{});var n=this,t=o.action||n.attr("action")||location.href,a=o.method||n.attr("method")||"get",s=!!o.fields&&o.fields,c=o.redirectSuccess||n.data("redirect-success")||!1,i=o.redirectError||n.data("redirect-error")||!1;return s&&"function"==typeof s&&(s=o.fields()),n.on("submit",function(){var e=new FormData(this);if(s)for(var r in s)e.append(r,s[r]);return u.ajax({url:t,method:a,data:e,cache:!1,contentType:!1,processData:!1,beforeSend:function(){o.beforeSend.call(this,n)},success:function(e){c&&(window.location.href=c),o.success.call(this,e,n)},error:function(e,r){var t="";t=0===e.status?"Not connect.\n Verify Network.":404==e.status?"Requested page not found. [404]":405==e.status?"Method Not Allowed. [405]":500==e.status?"Internal Server Error [500].":"parsererror"===r?"Requested JSON parse failed.":"timeout"===r?"Time out error.":"abort"===r?"Ajax request aborted.":"Uncaught Error.\n"+e.responseText,i&&(window.location.href=i),o.error.call(this,t,n)}}),!1}),this}}(jQuery);