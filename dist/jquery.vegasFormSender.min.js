/**
 * @name vegas form sender
 * @copyright by vegas s.
 * @date: 23.07.2018
 * @version  1.0
 *
 * Описание.
 * Программа для сборки данных с формы и отправки их на сервер через ajax,
 * упрощая обработку и выдачу результата...
 *
 * Инструкции.
 * Инициализация: $('#какая-то форма').vegasFormSender();
 *
 * Параметры:
 * action: путь до обработчика, так же может быть указан непосредственно в форме.
 * method: метод отправки get или post, так же может быть указан непосредственно в форме.
 * fields: дополнительные параметры, указываются в ввиде объекта {ключ: значение},
 * либо этот объект возвращается через колбэк например:
 * fields: function() {
 * 		return {ключ: значение}
 * }
 * redirectError: перенаправление на страницу с фатальной ошибкой
 * redirectSuccess: перенаправление на страницу после успешного запроса
 *
 * Обработчики событий:
 * Плагин возвращает два события, об удачной отправке или о фатальной ошибке:
 * success: function (data) {
 * 		// ответ пришел от сервера
 * }
 * error: function (status) {
 * 		// ответ не пришел от сервера
 * }
 */
!function(e){e.fn.vegasFormSender=function(r){var t=this,o=(r=e.extend({error:function(){},success:function(){}},arguments[0]||{})).action||t.attr("action")||location.href,s=r.method||t.attr("method")||"get",n=!!r.fields&&r.fields,a=r.redirectSuccess||t.data("redirect-success")||!1,c=r.redirectError||t.data("redirect-error")||!1;return n&&"function"==typeof n&&(n=r.fields()),t.on("submit",function(){var t=new FormData(this);if(n)for(var i in n)t.append(i,n[i]);return e.ajax({url:o,method:s,data:t,cache:!1,contentType:!1,processData:!1,success:function(t){var o=e.parseJSON(t);a&&(window.location.href=a),r.success.call(this,o)},error:function(e,t){0===e.status?msg="Not connect.\n Verify Network.":404==e.status?msg="Requested page not found. [404]":405==e.status?msg="Method Not Allowed. [405]":500==e.status?msg="Internal Server Error [500].":msg="parsererror"===t?"Requested JSON parse failed.":"timeout"===t?"Time out error.":"abort"===t?"Ajax request aborted.":"Uncaught Error.\n"+e.responseText,c&&(window.location.href=c),r.error.call(this,"")}}),!1}),this}}(jQuery);