!function(v){v.fn.vegasFormSender=function(l){l=v.extend({error:function(){},success:function(){},beforeSend:function(){},validate:function(){}},arguments[0]||{});return this.each(function(){var c=v(this),s=l.action||c.attr("action")||location.href,f=l.method||c.attr("method")||"get",d=!!l.fields&&l.fields,u=l.redirectSuccess||c.data("redirect-success")||!1;l.redirectError||c.data("redirect-error");d&&"function"==typeof d&&(d=l.fields());var h=!0;c.on("submit",function(){var e,r,t=new FormData(this),n=v(this).find("[data-validate]");if(n.length&&(r=[],n.each(function(){var e=v(this);""===e.val()&&r.push(e)}),e=r,l.validate.call(this,c,e),e.length&&(h=!1)),h){if(d)for(var a in d)if("object"==typeof d[a])for(var i in d[a]){var o=Object.keys(d[a][i]).map(function(e){return d[a][i][e]});t.append(a,o)}else t.append(a,d[a]);v.ajax({url:s,method:f,data:t,cache:!1,contentType:!1,processData:!1,beforeSend:function(){l.beforeSend.call(this,c)},success:function(e){var r=e;u?window.location.href=u:l.success.call(this,r,c)},error:function(e,r){var t=JSON.parse(e.responseText),n=t.errors?t.errors[Object.keys(t.errors)[0]][0]:t.message||t.msg;l.error.call(this,n,c)}})}return!1})}),this}}(jQuery);